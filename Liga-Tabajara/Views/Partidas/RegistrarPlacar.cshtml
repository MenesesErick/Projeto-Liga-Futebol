@model Partida

@using (Html.BeginForm("RegistrarPlacar", "Partidas", FormMethod.Post, new { id = "formRegistrar" }))
{
    @Html.AntiForgeryToken()
    @Html.HiddenFor(m => m.Id)

    <div class="form-row mb-4">
        <div class="form-group col-md-6">
            <h4>Gols – @Model.TimeCasa.Nome</h4>
            <div id="gols-casa-container"></div>
            <button type="button" class="btn btn-outline-primary btn-sm mt-2" onclick="adicionarGol('casa')">
                + Gol Casa
            </button>
            @Html.ValidationMessageFor(m => m.GolsCasa, null, new { @class = "text-danger" })
        </div>
        <div class="form-group col-md-6">
            <h4>Gols – @Model.TimeVisitante.Nome</h4>
            <div id="gols-visitante-container"></div>
            <button type="button" class="btn btn-outline-primary btn-sm mt-2" onclick="adicionarGol('visitante')">
                + Gol Visitante
            </button>
            @Html.ValidationMessageFor(m => m.GolsVisitante, null, new { @class = "text-danger" })
        </div>
    </div>

    <button type="submit" class="btn btn-success">Salvar Placar</button>
}

@section Scripts {
    <script>
    let contadorCasa = 0, contadorVisitante = 0;

    function adicionarGol(tipo) {
        const container = document.getElementById(`gols-${tipo}-container`);
        const index = tipo === 'casa' ? ++contadorCasa : ++contadorVisitante;

        // Serializa SelectList do ViewBag para JS
        const lista = tipo === 'casa'
            ? @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.JogadoresCasa))
            : @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.JogadoresVisitante));

        const div = document.createElement("div");
        div.className = "form-row mb-2";
        div.innerHTML = `
            <div class="col-8">
                <select name="${tipo === 'casa' ? 'Casa_Jogador_' : 'Visitante_Jogador_'}${index}"
                        class="form-control" required>
                    <option value="">--Selecione jogador--</option>
                    ${lista.map(j => `<option value="${j.Value}">${j.Text}</option>`).join('')}
                </select>
            </div>
            <div class="col-4">
                <input name="${tipo === 'casa' ? 'Casa_Minuto_' : 'Visitante_Minuto_'}${index}"
                       type="number" min="1" max="120" class="form-control" placeholder="Minuto" required />
            </div>`;
        container.appendChild(div);
    }
    </script>
}
