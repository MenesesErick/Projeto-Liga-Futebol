@model IEnumerable<Partida>

@{
    ViewBag.Title = "Partidas";
    // Agrupa partidas em rodadas de 10 jogos cada
    var partidasAgrupadas = Model
        .OrderBy(p => p.DataHora)
        .Select((p, idx) => new { Partida = p, Rodada = (idx / 10) + 1 })
        .GroupBy(x => x.Rodada);
}

<h2 class="mb-4">Partidas</h2>

<p>
    @Html.ActionLink("Criar nova partida", "Create", null, new { @class = "btn btn-success" })
</p>

<!-- Filtro -->
@using (Html.BeginForm("Index", "Partidas", FormMethod.Get, new { @class = "mb-4" }))
{
    <div class="card p-3">
        <div class="form-row">
            <div class="form-group col-md-2">
                <label for="dataFiltro">Data</label>
                <input id="dataFiltro" type="date" name="data" class="form-control" value="@ViewBag.DataFiltro" />
            </div>
            <div class="form-group col-md-3">
                <label for="timeFiltro">Time</label>
                @Html.DropDownList("timeId", (SelectList)ViewBag.Times, "Todos", new { @class = "form-control", id = "timeFiltro" })
            </div>
            <div class="form-group col-md-3">
                <label for="estadioFiltro">Estádio</label>
                <input id="estadioFiltro" type="text" name="estadio" class="form-control" placeholder="Nome do estádio" value="@ViewBag.EstadioFiltro" />
            </div>
            <div class="form-group col-md-3">
                <label for="jogoFiltro">Jogo</label>
                <input id="jogoFiltro" type="text" name="jogo" class="form-control" placeholder="Ex: TimeA x TimeB" value="@ViewBag.JogoFiltro" />
            </div>
            <div class="form-group col-md-1 align-self-end">
                <button type="submit" class="btn btn-primary btn-block">Filtrar</button>
            </div>
        </div>
    </div>
}

<!-- Tabelas por Rodada -->
@foreach (var grupo in partidasAgrupadas)
{
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">Rodada @grupo.Key</h5>
        </div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="thead-light">
                    <tr>
                        <th>Mandante</th>
                        <th>Visitante</th>
                        <th>Data/Hora</th>
                        <th>Gols Casa</th>
                        <th>Gols Visitante</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in grupo)
                    {
                        var partida = item.Partida;
                        <tr>
                            <td>@partida.TimeCasa.Nome</td>
                            <td>@partida.TimeVisitante.Nome</td>
                            <td>@partida.DataHora.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>@(partida.GolsCasa?.ToString() ?? "-")</td>
                            <td>@(partida.GolsVisitante?.ToString() ?? "-")</td>
                            <td>
                                <div class="btn-group btn-group-sm" role="group">
                                    @Html.ActionLink("Detalhes", "Details", new { id = partida.Id }, new { @class = "btn btn-outline-info" })
                                    @Html.ActionLink("Editar", "Edit", new { id = partida.Id }, new { @class = "btn btn-outline-warning" })
                                    @Html.ActionLink("Excluir", "Delete", new { id = partida.Id }, new { @class = "btn btn-outline-danger" })
                                    @if ((partida.GolsCasa ?? 0) == 0 && (partida.GolsVisitante ?? 0) == 0)
                                    {
                                        @Html.ActionLink("Registrar", "RegistrarPlacar", new { id = partida.Id }, new { @class = "btn btn-outline-success" })
                                    }
                                    else
                                    {
                                        <button type="button" class="btn btn-success disabled">Registrado</button>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
